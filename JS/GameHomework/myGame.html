<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>æ‹‰éœ¸</title>
    <link rel="stylesheet" href="./../reset.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <style>
        [row-id].active {
            border: solid 5px #ccc;
            box-shadow: 0 0 20px #ccf;
            transform: 0s;
        }

        i {
            line-height: 1.8;
        }

        .col-2 {
            text-align: center;
            font-size: 50px;
            height: 100px;
            justify-content: center;
        }

        .col-4 {
            display: flex;
            margin: auto;
            justify-content: center;
            font-size: 30px;
        }

        .col-4 p {
            margin: auto;
        }

        .col-4 img {
            display: block;
            margin: auto;
            width: 100px;
        }

        .btn {
            color: #fff;
            font-weight: 900;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-3"></div>
            <div col-id="1" row-id="0" class="col-2"></div>
            <div col-id="2" row-id="0" class="col-2"></div>
            <div col-id="3" row-id="0" class="col-2"></div>
            <div class="col-3"></div>
        </div>
        <div class="row">
            <div class="col-3"></div>
            <div col-id="1" row-id="1" class="col-2 active"></div>
            <div col-id="2" row-id="1" class="col-2 active"></div>
            <div col-id="3" row-id="1" class="col-2 active"></div>
            <div class="col-3"></div>
        </div>
        <div class="row">
            <div class="col-3"></div>
            <div col-id="1" row-id="2" class="col-2"></div>
            <div col-id="2" row-id="2" class="col-2"></div>
            <div col-id="3" row-id="2" class="col-2"></div>
            <div class="col-3"></div>
        </div>
        <div class="row">
            <div class="col-4">
                <p>å¤©ä¸‹æ­¦åŠŸ</p>
                <img src="./C8763.jpg" class="speed" alt="">
                <p>å”¯å¿«ä¸ç ´</p>
            </div>
            <div class="col-4">
                <button type="button" class="btn btn-info" id="start">é–‹å§‹</button>
            </div>
            <div class="col-4">
                <button type="button" class="btn btn-info" id="rest">ä¼‘æ¯ä¸€ä¸‹ é…å£èŒ¶</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>

    <script>
        let Mahjong = [
            {
                id: 0,
                emoji: "ğŸ€€"
            },
            {
                id: 1,
                emoji: "ğŸ€"
            },
            {
                id: 2,
                emoji: "ğŸ€‚"
            },
            {
                id: 3,
                emoji: "ğŸ€ƒ"
            },
            {
                id: 4,
                emoji: "ğŸ€„"
            },
            {
                id: 5,
                emoji: "ğŸ€…"
            },
            {
                id: 6,
                emoji: "ğŸ€†"
            },
        ]

        let c8763 = document.querySelector("img")
        let startbtn = document.querySelector("#start")
        let rest = document.querySelector("#rest")
        rest.addEventListener("click", c87);

        let firstLeftNum = 0;   //ç¬¬ä¸€æ¬„å‰©ä¸‹çš„æ ¼æ•¸
        let firstGridNum = 0;   //ç¬¬ä¸€æ¬„è¦è½‰çš„æ ¼æ•¸

        let leftNum = 0;        //ç¬¬äºŒæ¬„å‰©ä¸‹çš„æ ¼æ•¸
        let gridNum = 0;        //ç¬¬äºŒæ¬„è¦è½‰çš„æ ¼æ•¸

        let lastLeftNum = 0;    //ç¬¬ä¸‰æ¬„å‰©ä¸‹çš„æ ¼æ•¸
        let lastGridNum = 0;    //ç¬¬ä¸‰æ¬„è¦è½‰çš„æ ¼æ•¸

        let allGrids;   //å…¨éƒ¨çš„æ¬„
        let upgrids;    //å·¦æ¬„
        let grids;      //ä¸­æ¬„
        let downgrids;  //å³æ¬„

        let upTime = 0;     //ä¸Šä¸€æ ¼æ‰€åœ¨çš„æ ¼æ•¸
        let nowTime = 1;    //ç›®å‰æ‰€åœ¨çš„æ ¼æ•¸
        let downTime = 2;   //ä¸‹ä¸€æ ¼æ‰€åœ¨çš„æ ¼æ•¸

        let _colNum = 0;    //ç¬¬ä¸€æ¬„æ ¼æ•¸
        let colNum = 0;     //ç¬¬äºŒæ¬„æ ¼æ•¸
        let __colNum = 0;   //ç¬¬ä¸‰æ¬„æ ¼æ•¸

        let round1Time = 0;     //æ–¹æ³•è·‘çš„æ¬¡æ•¸
        let round2Time = 0;     //æ–¹æ³•è·‘çš„æ¬¡æ•¸
        let round3Time = 0;     //æ–¹æ³•è·‘çš„æ¬¡æ•¸

        let firstRoundTime = 0; //è¦æ›å¾—ç‰Œçš„ç« æ•¸
        let roundTime = 0;      //è¦æ›å¾—ç‰Œçš„ç« æ•¸
        let lastRoundTime = 0;  //è¦æ›å¾—ç‰Œçš„ç« æ•¸

        let _speed = 50;
        let speed = 60;
        let __speed = 70;

        let _out;
        let out;
        let __out;

        let drinkTime = 0;

        function start() {
            allGrids = document.querySelectorAll("[row-id]")
            // allGrids = Array.from(allGrids).sort((a, b) => {
            //     return a.getAttributeNode("id").value - b.getAttributeNode("id").value
            // })
            // console.log(allGrids)
            allGrids.forEach(x => {
                let id = x.getAttributeNode("row-id").value
                let data = Mahjong.find(x => x.id == id)
                let img = document.createElement("i")
                img.innerText = data.emoji
                x.appendChild(img)
            })
        }

        function run() {
            c8763.addEventListener("click", runningC87)
            startbtn.removeEventListener("click", run);
            
            // _speed = 50;
            // speed = 60;
            // __speed = 70;

            //============ç¬¬ä¸€å€‹==============
            let _runTime = Math.floor(Math.random() * Mahjong.length) + 1
            firstLeftNum = _runTime + (10 * allGrids.length);
            firstGridNum = firstLeftNum;

            //============ç¬¬äºŒå€‹==============
            let runTime = Math.floor(Math.random() * Mahjong.length) + 1
            leftNum = runTime + (20 * allGrids.length);
            gridNum = leftNum;

            //============ç¬¬ä¸‰å€‹==============
            let __runTime = Math.floor(Math.random() * Mahjong.length) + 1
            lastLeftNum = __runTime + (30 * allGrids.length);
            lastGridNum = lastLeftNum;

            round1()
        }

        function round1() {
            rest.removeEventListener("click", c87)
            rest.addEventListener("click", runningDrink)
            round1Time++;

            upgrids = document.querySelectorAll(`[col-id="1"]`)
            //============ç¬¬ä¸€å€‹==============

            if (round1Time >= Mahjong.length) {
                round1Time = 0;
            }

            upgrids.forEach(x => {

                if (_colNum >= upgrids.length) {
                    _colNum = 0;
                }
                firstRoundTime = _colNum + round1Time;
                if (firstRoundTime >= Mahjong.length) {
                    firstRoundTime -= 7;
                }
                x.setAttribute("row-id", `${firstRoundTime}`)
                let id = x.getAttributeNode("row-id").value
                let data = Mahjong.find(x => x.id == id)
                let img = x.querySelector("i")
                img.innerText = data.emoji
                x.appendChild(img)
                _colNum++;
            })
            firstLeftNum--;
            // console.log(`ç¬¬ä¸€å€‹:è¦èµ°çš„æ­¥æ•¸${firstGridNum},å‰©ä¸‹çš„æ­¥æ•¸${firstLeftNum}`)


            if (firstLeftNum > 0) {

                _out = setTimeout(round1, _speed);

                if (firstLeftNum < Math.floor((firstGridNum / 5))) {
                    _speed += 7
                }
                else if (firstGridNum - 3 == firstLeftNum) round2()
            }
            else {
                clearTimeout(_out);
            }
            // let newGrids = [upgrids, grids, downgrids];
            // newGrids.forEach(x => {
            // colNum = 0 + upTime;
            // x.forEach(y => {}
            //æ›åœ–
            // upgrids.forEach(x => {
            //     x.setAttribute("row-id", `${upTime}`)
            //     let id = x.getAttributeNode("row-id").value
            //     let data = Mahjong.find(x => x.id == id)
            //     let img = x.querySelector("i")
            //     img.innerText = data.emoji
            //     x.appendChild(img)
            // })

        }
        function round2() {
            grids = document.querySelectorAll(`[col-id="2"]`)
            round2Time++;

            if (round2Time >= Mahjong.length) {
                round2Time = 0;
            }

            grids.forEach(x => {
                if (colNum >= grids.length) {
                    colNum = 0;
                }
                roundTime = colNum + round2Time;
                if (roundTime >= Mahjong.length) {
                    roundTime -= 7;
                }
                x.setAttribute("row-id", `${roundTime}`)
                let id = x.getAttributeNode("row-id").value
                let data = Mahjong.find(x => x.id == id)
                let img = x.querySelector("i")
                img.innerText = data.emoji
                x.appendChild(img)
                colNum++;
            })
            leftNum--;
            // console.log(`ç¬¬äºŒå€‹:è¦èµ°çš„æ­¥æ•¸${gridNum},å‰©ä¸‹çš„æ­¥æ•¸${leftNum}`)

            if (leftNum > 0) {

                out = setTimeout(round2, speed);

                if (leftNum < Math.floor((gridNum / 5))) {
                    speed += 7
                }
                else if (gridNum - 3 == leftNum) round3()

            }
            else {
                clearTimeout(out)
            }


        }
        function round3() {
            downgrids = document.querySelectorAll(`[col-id="3"]`)
            round3Time++;

            if (round3Time >= Mahjong.length) {
                round3Time = 0;
            }

            downgrids.forEach(x => {
                if (__colNum >= downgrids.length) {
                    __colNum = 0;
                }
                lastRoundTime = __colNum + round3Time;
                if (lastRoundTime >= Mahjong.length) {
                    lastRoundTime -= 7;
                }
                x.setAttribute("row-id", `${lastRoundTime}`)
                let id = x.getAttributeNode("row-id").value
                let data = Mahjong.find(x => x.id == id)
                let img = x.querySelector("i")
                img.innerText = data.emoji
                x.appendChild(img)
                __colNum++
            })
            lastLeftNum--;
            // console.log(`ç¬¬ä¸‰å€‹:è¦èµ°çš„æ­¥æ•¸${lastGridNum},å‰©ä¸‹çš„æ­¥æ•¸${lastLeftNum}`)
            // upTime++;

            // if (upTime >= Mahjong.length) {
            //     upTime = 0;
            // }

            // upgrids.forEach(x => {

            //     if (_colNum >= Mahjong.length) {
            //         _colNum = 0;
            //     }
            //     x.setAttribute("row-id", `${_colNum}`)
            //     let id = x.getAttributeNode("row-id").value
            //     let data = Mahjong.find(x => x.id == id)
            //     let img = x.querySelector("i")
            //     img.innerText = data.emoji
            //     x.appendChild(img)
            //     _colNum++;
            // })

            // firstLeftNum--;
            // console.log(`ç¬¬ä¸€å€‹:è¦èµ°çš„æ­¥æ•¸${firstGridNum},å‰©ä¸‹çš„æ­¥æ•¸${firstLeftNum}`)


            if (lastLeftNum > 0) {
                __out = setTimeout(round3, __speed);

                if (lastLeftNum < Math.floor((lastGridNum / 5))) {
                    __speed += 7
                }
            }
            else {
                clearTimeout(__out)
                c8763.removeEventListener("click", runningC87)
                startbtn.addEventListener("click", run)
                rest.removeEventListener("click", runningDrink)
                rest.addEventListener("click", drink)
                c8763.addEventListener("click", cd)
                check()
                _speed = 50;
                speed = 60;
                __speed = 70;
            }
        }

        function check() {
            c8763.addEventListener("click", cd)
            let result = document.querySelectorAll(".col-2.active")
            let Father = result[0].parentNode
            let i = Father.querySelector('i')

            let item = result[0].getAttributeNode("row-id")
            let item1 = result[1].getAttributeNode("row-id")
            let item2 = result[2].getAttributeNode("row-id")
            if (item.value == item1.value && item1.value == item2.value && item2.value == item.value) {
                alert(`æ­å–œä½ å¾—åˆ°${i.innerHTML}åˆ»å­`)
            }
            else if (item.value == item1.value || item1.value == item2.value) {
                alert(`æ­å–œä½ å¾—åˆ°${i.innerHTML}ä¸€å°çœ¼`)
            }
        }

        function hayaku() {
            _speed = 10
            speed = 5
            __speed = 0
            alert("ä½ å·²ç¶“ä½¿ç”¨æ˜Ÿçˆ†æ°£æµè½‰\nè«‹æŒ‰ä¸‹é–‹å§‹ä½¿ç”¨")
            c8763.removeEventListener("click", hayaku)


            drinkTime = 0;
        }

        function c87() {
            alert("ä½ é‚„æ²’æ˜Ÿçˆ†ï¼Œé‚„ä¸èƒ½å–èŒ¶")
        }
        function runningDrink() {
            alert("ä½ æ­£åœ¨æ˜Ÿçˆ†ä¸­ï¼Œæ²’æ³•å–èŒ¶")
        }
        function cd() {
            alert("æŠ€èƒ½å†·å»ä¸­ï¼Œæ˜æ—¥è«‹æ—©")
        }
        function runningC87() {
            alert("ä½ æ²’è¾¦æ³•å†è½‰ä¸­é€”æ˜Ÿçˆ†")
        }
        function drink() {
            if (drinkTime < 1) {
                alert("ä½ å–æ¯èŒ¶ï¼Œå¯ä»¥å†æ¬¡æ˜Ÿçˆ†äº†")
            } else {
                alert("ä½ ç¾åœ¨å¾ˆé£½ï¼Œå–ä¸ä¸‹äº†")
            }
            c8763.removeEventListener("click", cd)
            c8763.addEventListener("click", hayaku)
            drinkTime++;
        }

        window.onload = function () {
            start()
            c8763.addEventListener("click", hayaku)
            startbtn.addEventListener("click", run)
        }
    </script>

</body>

</html>